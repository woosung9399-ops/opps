<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>포춘쿠키 오늘의 운세</title>
<meta name="theme-color" content="#FFE18A"/>
<meta name="description" content="포춘쿠키를 열면 오늘의 운세가 펼쳐집니다. 금전·직장·애정·학업·건강 점수와 행운 키워드 제공."/>
<style>
  :root{
    --grid:#f8d875;
    --bg:#ffe18a;
    --ink:#5a3b1a;
    --accent:#ff8a42;
    --accent-deep:#ea6a1b;
    --card:#fffaf0;
    --muted:#8b6d4e;
    --good:#ff8a42;
  }
  *{box-sizing:border-box}
  html:focus-within{scroll-behavior:smooth}
  body{
    margin:0; font-family:ui-sans-serif, system-ui, -apple-system, "Pretendard","Segoe UI",sans-serif;
    color:var(--ink); background:
      repeating-linear-gradient(0deg, var(--bg), var(--bg) 48px, var(--grid) 48px, var(--grid) 50px),
      var(--bg);
    min-height:100dvh;
  }

  /* ===== 공통 헤더/푸터 ===== */
  .site-header{
    position:sticky; top:0; z-index:10;
    display:flex; align-items:center; gap:12px; justify-content:space-between;
    background:#fff; padding:10px 14px; border-bottom:1px solid #e5e7eb;
  }
  .site-header .logo img{height:28px; max-width:140px; object-fit:contain; display:block}
  .site-header h1{margin:0; font-size:1.05rem; color:#111; text-align:center; flex:1}
  .site-header .today{font-size:.9rem; color:#444}

  footer{
    position:fixed; left:0; right:0; bottom:0; text-align:center; padding:10px 0;
    font-size:.85rem; color:#6b7280; background:rgba(255,255,255,.6); backdrop-filter:blur(6px);
    border-top:1px solid #e5e7eb;
  }

  /* ===== 뷰 전환 ===== */
  .container{max-width:860px; margin:0 auto; padding:16px; padding-bottom:72px}
  .view{display:none; animation:.35s ease both fadeInUp}
  .view.active{display:block}
  @keyframes fadeInUp{from{opacity:0; transform:translate3d(0,10px,0)} to{opacity:1; transform:none}}

  /* ===== 인트로 ===== */
  .intro{
    display:grid; place-items:center; min-height:calc(100svh - 120px);
    text-align:center; gap:14px;
  }
  .intro h2{
    margin:0; font-size:1.8rem; line-height:1.25; letter-spacing:.01em; color:#7b4b22;
    text-shadow:0 2px 0 rgba(255,255,255,.35);
  }
  .intro p{margin:0; color:var(--muted)}
  .plate{
    margin-top:8px; width:min(78vw,360px); aspect-ratio:1/1; border-radius:50%;
    background:
      radial-gradient(closest-side, #fff 0 55%, transparent 56%),
      radial-gradient(circle at 50% 50%, rgba(0,0,0,.03), rgba(0,0,0,0) 60%),
      #f9f9f9;
    box-shadow: 0 20px 40px rgba(0,0,0,.18) inset, 0 24px 40px rgba(0,0,0,.18);
    display:grid; place-items:center; position:relative;
  }
  .touch-tip{
    position:absolute; top:14%; left:18%; font-size:1rem; color:#ad794e; transform:rotate(-12deg);
    opacity:.9
  }
  .cookie{width:66%; filter:drop-shadow(0 14px 22px rgba(0,0,0,.25)); cursor:pointer}
  .cookie:active{transform:scale(.98)}
  .cta{
    display:inline-block; margin-top:10px; padding:10px 16px; border-radius:999px;
    background:linear-gradient(180deg, var(--accent), var(--accent-deep)); color:#fff; font-weight:700;
    box-shadow:0 6px 0 #ce5c14; user-select:none; cursor:pointer
  }
  .cta:active{transform:translateY(2px); box-shadow:0 4px 0 #ce5c14}

  /* ===== 결과 카드 ===== */
  .card{
    background:var(--card); border:1px solid #f2e5cf; border-radius:16px; padding:16px;
    box-shadow:0 10px 32px rgba(0,0,0,.12);
  }
  .result-msg{font-size:1.05rem; line-height:1.6; margin:0}
  .scores{margin-top:14px; display:grid; gap:10px}
  .row{display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:10px}
  .label{font-weight:700}
  .bar{height:12px; border-radius:999px; background:#fde7d5; position:relative; overflow:hidden}
  .bar>i{
    position:absolute; inset:0; width:var(--w,0%); background:linear-gradient(90deg,#ff9f5c,#ff7a2a);
    border-radius:999px; transition:width .8s cubic-bezier(.2,.8,.2,1);
  }
  .val{font-weight:800; color:#d8611c}

  .kw{margin-top:14px}
  .kw h3{margin:0 0 8px; font-size:1rem}
  .kwgrid{display:grid; gap:10px}
  .krow{display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:10px; padding:10px; border-radius:12px; background:#fff}
  .kico{font-size:1.15rem}
  .klabel{color:#7a5935}
  .btns{display:flex; gap:8px; flex-wrap:wrap; margin-top:14px}
  button{
    all:unset; cursor:pointer; padding:10px 14px; background:#fff; border:1px solid #e5e7eb; border-radius:10px; font-weight:700;
  }
  button.primary{background:linear-gradient(180deg,#ff9f5c,#ff7a2a); color:#fff; border-color:#ff8a42}

  /* ===== 오류 오버레이 ===== */
  #errOverlay{display:none; position:fixed; inset:0; background:rgba(0,0,0,.8); color:#fff; z-index:9999; padding:16px; overflow:auto}
  #errOverlay pre{white-space:pre-wrap; word-break:break-word; background:rgba(255,255,255,.08); padding:12px; border-radius:8px}
</style>
</head>
<body>
  <!-- 공통 흰색 헤더 -->
  <header class="site-header">
    <div class="logo">
      <img src="https://api.multicampus.com/ssf/v1/resource/public/images/FILBS202506207041267" alt="multicampus logo">
    </div>
    <h1>포춘쿠키</h1>
    <div class="today" id="today"></div>
  </header>

  <div class="container">
    <!-- 인트로 화면 -->
    <section id="viewIntro" class="view intro active" aria-label="포춘쿠키 인트로">
      <div>
        <h2 id="introTitle">행운님, 포춘쿠키를 열면</h2>
        <p>자세한 오늘의 운세를 볼 수 있어요.</p>
      </div>

      <div class="plate" aria-hidden="true">
        <span class="touch-tip">Touch!</span>
        <!-- 쿠키 SVG -->
        <svg class="cookie" id="cookieBtn" viewBox="0 0 512 320" role="button" tabindex="0" aria-label="포춘쿠키 열기">
          <defs>
            <linearGradient id="g1" x1="0" x2="1">
              <stop offset="0" stop-color="#f7b06b"/>
              <stop offset="1" stop-color="#e08a41"/>
            </linearGradient>
            <radialGradient id="shine" cx="30%" cy="20%" r="60%">
              <stop offset="0" stop-color="#fff7" />
              <stop offset="1" stop-color="#0000"/>
            </radialGradient>
          </defs>
          <path d="M280 60c-46 8-88 44-112 82-26 42-32 86-20 106 10 17 40 30 74 10 30-18 56-64 70-118 10-39 7-77-12-80z" fill="url(#g1)"/>
          <path d="M232 62c49-14 115 3 154 36 40 33 58 83 48 109-9 24-48 37-86 18-33-16-60-55-78-105-13-36-20-59-38-58z" fill="url(#g1)"/>
          <ellipse cx="250" cy="110" rx="120" ry="80" fill="url(#shine)"/>
        </svg>
      </div>

      <div class="cta" id="cookieCta">터치해 주세요!</div>
    </section>

    <!-- 결과 화면 -->
    <section id="viewResult" class="view" aria-label="운세 결과">
      <div class="card" id="cardResult">
        <p class="result-msg" id="fortuneText">결과를 불러오는 중…</p>

        <div class="scores" id="scores">
          <!-- JS에서 행 삽입 -->
        </div>

        <div class="kw">
          <h3>행운 키워드</h3>
          <div class="kwgrid" id="kwGrid">
            <!-- JS에서 삽입 -->
          </div>
        </div>

        <div class="btns">
          <button id="againBtn" class="primary">다시 열기</button>
          <button id="shareBtn">공유/복사</button>
          <button id="linkBtn">링크</button>
        </div>
      </div>
    </section>
  </div>

  <footer>© multicampus arcade</footer>

  <!-- 오류 오버레이 -->
  <div id="errOverlay" role="alert" aria-live="assertive">
    <h3>스크립트 오류가 발생했습니다</h3>
    <p>복사/붙여넣기 과정에서 빠진 부분이 없는지 확인해 주세요.</p>
    <pre id="errText"></pre>
  </div>

<script>
"use strict";

/* ===== 오류 표시기 ===== */
(function(){
  const show = (msg) => {
    try{
      const el = document.getElementById('errOverlay');
      const pre = document.getElementById('errText');
      if(!el || !pre) return;
      pre.textContent = String(msg || '알 수 없는 오류');
      el.style.display = 'block';
    }catch(_){}
  };
  window.addEventListener('error', (e)=> show(e.message + (e.filename? `\\nat ${e.filename}:${e.lineno}:${e.colno}`:'')));
  window.addEventListener('unhandledrejection', (e)=> show('Promise 오류: ' + (e.reason && e.reason.message ? e.reason.message : String(e.reason))));
})();

/* ===== 날짜/유틸 ===== */
const $ = (s)=>document.querySelector(s);
const todayEl = $("#today");
function fmtDate(){
  try{
    const f = new Intl.DateTimeFormat('ko-KR',{dateStyle:'medium'});
    return f.format(new Date());
  }catch(_){
    const d=new Date(); return `${d.getFullYear()}.${d.getMonth()+1}.${d.getDate()}`;
  }
}
todayEl.textContent = fmtDate();

/* ===== 난수 (시드 링크 지원) ===== */
function LCG(seed){ let s=(seed>>>0); return ()=> ((s = (s*1664525 + 1013904223)>>>0) / 4294967296); }
function parseSeed(){ try{ const u=new URL(location.href); const s=u.searchParams.get('s'); if(s===null) return null; const n=Number(s); return Number.isFinite(n)? n:null; }catch(_){ return null } }
function makeSeedLink(seed){ const u=new URL(location.href); u.searchParams.set('s', String(seed>>>0)); return u.toString(); }

/* ===== 데이터 풀 ===== */
const MSG = {
  love: [
    "오늘은 사랑에 온기가 더해지는 날. 마음을 솔직히 건네 보세요.",
    "감정의 속도를 맞추면 관계가 한층 가까워집니다.",
    "작은 친절 하나가 분위기를 바꿉니다."
  ],
  work: [
    "핵심 한 가지를 완주하면 성과가 따라옵니다.",
    "협업의 운이 있어요. 도움을 주고받아 보세요.",
    "데이터와 근거로 설득할 때 성과가 큽니다."
  ],
  money: [
    "지출을 계획하면 수익이 지켜집니다.",
    "충동구매를 피하고 비교·보류 전략이 유리합니다.",
    "고정비 점검이 오늘의 효자."
  ],
  study: [
    "짧고 자주—분산 학습이 효율을 냅니다.",
    "개념 정리와 복습에 초점을 두면 성과가 커집니다.",
    "오늘 외운 것은 오늘 점검!"
  ],
  health: [
    "컨디션 관리에 ‘수면’이 열쇠입니다.",
    "가벼운 스트레칭과 수분 보충으로 리듬을 회복하세요.",
    "무리는 금물. 미세한 회복이 곧 체력입니다."
  ],
  general: [
    "작은 시작이 큰 변화를 부릅니다. 오늘의 나를 응원하세요.",
    "행운은 준비된 곳을 좋아합니다. 계획을 한 줄 적어봅시다.",
    "타이밍이 좋습니다. 가볍게 시도해도 좋아요."
  ]
};
const DIRECTIONS = ["동쪽","서쪽","남쪽","북쪽","동남","서남","동북","서북"];
const COLORS = ["피어나는 핑크","호박 오렌지","순한 베이지","바나나 옐로","숲 그린","하늘 블루","보라 바이올렛","차분한 네이비"];
const FOODS = ["순두부찌개","김치볶음밥","파스타","비빔국수","불고기","연어초밥","우동","치킨","팥빙수","라떼"];
const ICON = {num:"📙", dir:"🧭", col:"🎨", food:"🍲"};

/* ===== 요소 ===== */
const viewIntro = $("#viewIntro");
const viewResult = $("#viewResult");
const cookieBtn = $("#cookieBtn");
const cookieCta = $("#cookieCta");
const againBtn  = $("#againBtn");
const fortuneText = $("#fortuneText");
const scoresEl = $("#scores");
const kwGrid = $("#kwGrid");
const shareBtn = $("#shareBtn");
const linkBtn = $("#linkBtn");

/* ===== 로직 ===== */
function randGen(seed){
  const r = seed!=null ? LCG(seed) : Math.random;
  const pick = (arr)=> arr[Math.floor(r()*arr.length)];
  const n100 = ()=> Math.floor(60 + r()*40); // 60~100
  const scores = {
    금전: n100(),
    직장: n100(),
    애정: n100(),
    학업: n100(),
    건강: n100()
  };
  // 최상위 카테고리
  const top = Object.entries(scores).sort((a,b)=>b[1]-a[1])[0][0];
  let domain = "general";
  if(top==="애정") domain="love";
  else if(top==="직장") domain="work";
  else if(top==="금전") domain="money";
  else if(top==="학업") domain="study";
  else if(top==="건강") domain="health";

  const message = pick(MSG[domain]);
  const lucky = {
    num: Math.floor(1 + r()*99),
    dir: pick(DIRECTIONS),
    col: pick(COLORS),
    food: pick(FOODS)
  };
  return {scores, message, lucky, domain};
}

function renderScores(scores){
  scoresEl.innerHTML = "";
  for(const [label,val] of Object.entries(scores)){
    const row = document.createElement('div'); row.className="row";
    const l = document.createElement('div'); l.className="label"; l.textContent=label;
    const bar = document.createElement('div'); bar.className="bar";
    const fill = document.createElement('i'); fill.style.setProperty('--w', val+'%'); bar.appendChild(fill);
    const v = document.createElement('div'); v.className="val"; v.textContent = `${val}점`;
    row.append(l, bar, v); scoresEl.appendChild(row);
    // 애니메이션 지연
    setTimeout(()=>{ fill.style.width = val+'%'; }, 30);
  }
}
function renderKeywords(kw){
  kwGrid.innerHTML = "";
  const rows = [
    {ico:ICON.num, label:"숫자", value:String(kw.num)},
    {ico:ICON.dir, label:"방향", value:kw.dir},
    {ico:ICON.col, label:"컬러", value:kw.col},
    {ico:ICON.food,label:"음식", value:kw.food},
  ];
  rows.forEach(r=>{
    const div = document.createElement('div'); div.className='krow';
    const i = document.createElement('div'); i.className='kico'; i.textContent=r.ico;
    const l = document.createElement('div'); l.className='klabel'; l.textContent=r.label;
    const v = document.createElement('div'); v.style.fontWeight='800'; v.textContent=r.value;
    div.append(i,l,v); kwGrid.appendChild(div);
  });
}

function showResult(seed){
  const {scores, message, lucky} = randGen(seed);
  fortuneText.textContent = message;
  renderScores(scores);
  renderKeywords(lucky);
  viewIntro.classList.remove('active');
  viewResult.classList.add('active');
  // 진동
  if(navigator.vibrate) try{ navigator.vibrate(8); }catch(_){}
}

/* ===== 이벤트 ===== */
function openCookie(){
  const seed = parseSeed() ?? (Date.now()>>>0);
  showResult(seed);
}
cookieBtn.addEventListener('click', openCookie);
cookieBtn.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); openCookie(); }});
cookieCta.addEventListener('click', openCookie);
againBtn.addEventListener('click', ()=>{
  const seed = Date.now()>>>0;
  const u=new URL(location.href); u.searchParams.set('s', String(seed)); history.replaceState(null,'',u);
  showResult(seed);
});

/* 공유/링크 */
shareBtn.addEventListener('click', async ()=>{
  const text = `🍪 오늘의 포춘쿠키 (${fmtDate()})
- ${fortuneText.textContent}
- 링크: ${location.href}`;
  try{
    if(navigator.share){ await navigator.share({title:"오늘의 포춘쿠키", text}); }
    else{ await navigator.clipboard.writeText(text); alert("복사 완료! 원하는 곳에 붙여넣기 하세요."); }
  }catch(_){}
});
linkBtn.addEventListener('click', async ()=>{
  const seed = parseSeed() ?? (Date.now()>>>0);
  const url = makeSeedLink(seed);
  try{ await navigator.clipboard.writeText(url); alert('링크가 복사되었습니다!'); }
  catch{ prompt('아래 링크를 복사하세요', url); }
});

/* 인트로 제목에 이름/아이디 표시 (옵션) ?n=우성 / ?id=1729 */
(function(){
  const u=new URL(location.href);
  const name = u.searchParams.get('n');
  const id = u.searchParams.get('id');
  const title = $("#introTitle");
  if(name){ title.textContent = `${name}님, 포춘쿠키를 열면`; }
  else if(id){ title.textContent = `${id}님, 포춘쿠키를 열면`; }
})();
</script>
</body>
</html>