<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì˜¤ëŠ˜ì˜ íƒ€ë¡œ</title>
<meta name="description" content="ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œë§ˆë‹¤ ë¬´ì œí•œìœ¼ë¡œ ì¹´ë“œë¥¼ ë½‘ê³ , ì‚¬ë‘/ì¼/ê¸ˆì „ í•´ì„ê³¼ ê³µìœ , íˆìŠ¤í† ë¦¬, ì‹œë“œ ë§í¬ë¥¼ ì§€ì›í•©ë‹ˆë‹¤." />
<meta name="theme-color" content="#0f0f14" />
<style>
  :root{
    --bg:#0f0f14;--card:#181820;--accent:#7c5cff;--text:#f5f5f7;--muted:#b9b8c6;--good:#58d68d;--bad:#ff7675;
    --ring:rgba(124,92,255,.6);
  }
  *{box-sizing:border-box}
  html:focus-within { scroll-behavior:smooth }
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Pretendard","Segoe UI",sans-serif;
    background: radial-gradient(1200px 600px at 50% -10%, #222 0%, #111 40%, #0a0a0f 100%);
    color:var(--text); display:flex; min-height:100dvh; align-items:center; justify-content:center; padding:24px;
  }
  .app{width:100%; max-width:780px}
  header{display:flex; align-items:center; justify-content:space-between; margin-bottom:14px}
  h1{font-size:1.25rem; margin:0; letter-spacing:.02em}
  .date{color:var(--muted); font-size:.9rem}
  .wrap{
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:16px 16px 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
  }
  .grid{display:grid; grid-template-columns:1fr; gap:14px}
  @media (min-width:920px){ .grid{grid-template-columns: 320px 1fr} }
  .cardbox{display:flex; justify-content:center; perspective:1000px;}
  .card{
    width:min(80vw,300px); height:450px; border-radius:16px; position:relative; cursor:pointer;
    transform-style:preserve-3d; transition:transform .8s cubic-bezier(.2,.7,.2,1);
  }
  .card.flipped{transform:rotateY(180deg)}
  @media (prefers-reduced-motion: reduce){ .card{ transition:none } }
  .face{position:absolute; inset:0; backface-visibility:hidden; border-radius:16px; overflow:hidden;
    display:flex; align-items:center; justify-content:center; box-shadow:0 16px 40px rgba(0,0,0,.45)}
  .front{
    background:
      radial-gradient(400px 200px at 50% 0%, rgba(124,92,255,.25), transparent 60%),
      linear-gradient(135deg, #1f1b2e, #141420);
    border:1px solid rgba(124,92,255,.4);
  }
  .back{
    transform:rotateY(180deg);
    background:
      radial-gradient(500px 220px at 50% -5%, rgba(124,92,255,.22), transparent 60%),
      linear-gradient(160deg, #111318, #171924);
    border:1px solid rgba(255,255,255,.08);
    padding:16px;
  }
  .sigil{
    width:70%; aspect-ratio:1/1; border-radius:50%; border:2px dashed rgba(255,255,255,.14);
    display:flex; align-items:center; justify-content:center; color:#fff; font-size:3rem; user-select:none;
    background: radial-gradient(60% 60% at 50% 45%, rgba(255,255,255,.06), transparent);
  }
  .brand{position:absolute; inset:auto 14px 14px auto; font-size:.8rem; color:var(--muted);
    background:rgba(0,0,0,.25); padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.08)}
  .name{font-weight:700; text-align:center; margin:6px 0 8px; letter-spacing:.02em}
  .dir{font-size:.85rem; color:var(--muted); text-align:center; margin-bottom:8px}
  .keywords{display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin:6px 0 10px}
  .pill{font-size:.85rem; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08)}
  .advice{font-size:1rem; line-height:1.55; background:rgba(124,92,255,.09);
    border:1px solid rgba(124,92,255,.35); padding:12px 14px; border-radius:12px; text-align:center}
  .advice.good{background:rgba(88,214,141,.08); border-color:rgba(88,214,141,.4)}
  .advice.bad{background:rgba(255,118,117,.08); border-color:rgba(255,118,117,.45)}
  .btns{display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:10px}
  button{
    all:unset; padding:10px 14px; border-radius:10px; border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.06); cursor:pointer; font-weight:600; letter-spacing:.01em; text-align:center
  }
  button:focus-visible{ outline:3px solid var(--ring); outline-offset:2px; border-color:transparent }
  button.primary{background:linear-gradient(180deg, #7c5cff, #5f45e6); border-color:#7c5cff}
  button.ghost[aria-selected="true"]{outline:2px solid var(--accent)}
  .panel{
    background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px
  }
  .panel h3{margin:0 0 8px; font-size:1rem}
  .list{display:grid; gap:8px}
  .line{font-size:.98rem; line-height:1.55; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); padding:10px 12px; border-radius:10px}
  footer{margin-top:12px; text-align:center; color:var(--muted); font-size:.85rem}
  .row{display:grid; gap:10px}
  @media(min-width:560px){ .row{grid-template-columns:1fr 1fr} }
  .history{display:grid; gap:8px; max-height:210px; overflow:auto; padding-right:4px}
  .hist-item{display:flex; align-items:center; gap:8px; font-size:.92rem; padding:8px 10px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius:10px}
  .dot{width:8px; height:8px; border-radius:50%}
  .dot.u{background:var(--good)} .dot.r{background:var(--bad)}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size:.85rem; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.14); padding:.1rem .4rem; border-radius:6px}
  /* ì˜¤ë¥˜ ì˜¤ë²„ë ˆì´ */
  #errOverlay{display:none; position:fixed; inset:0; background:rgba(0,0,0,.8); color:#fff; z-index:9999; padding:16px; overflow:auto}
  #errOverlay pre{white-space:pre-wrap; word-break:break-word; background:rgba(255,255,255,.08); padding:12px; border-radius:8px}
</style>
</head>
<body>
  <div class="app">
    <header>
      <h1>ì˜¤ëŠ˜ì˜ íƒ€ë¡œ</h1>
      <div class="date" id="dateText" aria-live="polite"></div>
    </header>

    <div class="wrap" role="region" aria-label="íƒ€ë¡œ ì¹´ë“œ ì˜ì—­">
      <div class="grid">
        <!-- ì¹´ë“œ -->
        <div>
          <div class="cardbox">
            <div id="card" class="card" role="button" tabindex="0" aria-pressed="false" aria-label="ì¹´ë“œ ë’¤ì§‘ê¸° (Enter/Space)">
              <div class="face front" title="ì¹´ë“œë¥¼ íƒ­í•´ ë’¤ì§‘ê¸°">
                <div class="sigil">ğŸ”®</div>
                <div class="brand" aria-hidden="true">TAROT Â· RANDOM</div>
              </div>
              <div class="face back" aria-live="polite">
                <div style="width:100%;">
                  <div class="name" id="cardName">ì¹´ë“œë¥¼ ë½‘ì•„ë³´ì„¸ìš”</div>
                  <div class="dir" id="cardDir">ì •/ì—­ë°©í–¥</div>
                  <div class="keywords" id="keywords"></div>
                  <div class="advice" id="advice">ì—¬ê¸°ì— ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
                </div>
              </div>
            </div>
          </div>
          <div class="btns" style="margin-top:10px">
            <button id="drawBtn" class="primary" title="ìƒˆ ì¹´ë“œë¥¼ ë½‘ìŠµë‹ˆë‹¤ (ë‹¨ì¶•í‚¤: D)">ì¹´ë“œ ë½‘ê¸°</button>
            <button id="flipBtn" title="ì¹´ë“œë¥¼ ë’¤ì§‘ìŠµë‹ˆë‹¤ (ë‹¨ì¶•í‚¤: F)">ì¹´ë“œ ë’¤ì§‘ê¸°</button>
            <button id="shareBtn" title="í…ìŠ¤íŠ¸ë¡œ ê³µìœ í•˜ê±°ë‚˜ ë³µì‚¬í•©ë‹ˆë‹¤">ê³µìœ </button>
            <button id="linkBtn" title="ê°™ì€ ê²°ê³¼ë¥¼ ì—´ ìˆ˜ ìˆëŠ” ë§í¬ ìƒì„±">ë§í¬</button>
            <button id="resetBtn" title="í™”ë©´ ì´ˆê¸°í™”">ì´ˆê¸°í™”</button>
          </div>
          <div class="date" style="margin-top:8px">ë‹¨ì¶•í‚¤: <span class="kbd">D</span> ë½‘ê¸° Â· <span class="kbd">F</span> ë’¤ì§‘ê¸° Â· <span class="kbd">L</span> ë§í¬</div>
        </div>

        <!-- ìš°ì¸¡ íŒ¨ë„ -->
        <div class="row">
          <div>
            <div class="btns" role="tablist" aria-label="ë¶„ì•¼ ì„ íƒ">
              <button class="ghost" id="tabGeneral" role="tab" aria-selected="true">ì „ì²´</button>
              <button class="ghost" id="tabLove" role="tab" aria-selected="false">ì‚¬ë‘</button>
              <button class="ghost" id="tabWork" role="tab" aria-selected="false">ì¼</button>
              <button class="ghost" id="tabMoney" role="tab" aria-selected="false">ê¸ˆì „</button>
            </div>
            <div class="panel" id="panel">
              <h3 id="panelTitle">ì˜¤ëŠ˜ì˜ í•µì‹¬ ë©”ì‹œì§€</h3>
              <div class="list">
                <div class="line" id="line1">ì¹´ë“œë¥¼ ë½‘ìœ¼ë©´ ë¶„ì•¼ë³„ í•´ì„ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
                <div class="line" id="line2"></div>
                <div class="line" id="line3"></div>
              </div>
            </div>
          </div>
          <div>
            <div class="panel">
              <h3 style="margin-bottom:8px">ìµœê·¼ ë½‘ì€ ì¹´ë“œ</h3>
              <div class="history" id="history" aria-live="polite"></div>
              <div class="date" style="margin-top:6px">ìµœëŒ€ 10ê°œ ì €ì¥ Â· ê¸°ê¸° ë¡œì»¬ì—ë§Œ ë³´ê´€ë©ë‹ˆë‹¤</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>ë¬´ì œí•œ ëœë¤ Â· ê³µìœ /ë§í¬/íˆìŠ¤í† ë¦¬ ì§€ì› Â· <span id="ver">v2</span></footer>
  </div>

  <!-- ì˜¤ë¥˜ ì˜¤ë²„ë ˆì´ -->
  <div id="errOverlay" role="alert" aria-live="assertive">
    <h3>ìŠ¤í¬ë¦½íŠ¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h3>
    <p>ì´ í™”ë©´ì´ ê³„ì† ë³´ì´ë©´ ë³µì‚¬/ë¶™ì—¬ë„£ê¸° ê³¼ì •ì—ì„œ ë¹ ì§„ ë¶€ë¶„ì´ ì—†ëŠ”ì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
    <pre id="errText"></pre>
  </div>

<script>
"use strict";

/* ===== ì˜¤ë¥˜ í‘œì‹œê¸° ===== */
(function(){
  const show = (msg) => {
    try{
      const el = document.getElementById('errOverlay');
      const pre = document.getElementById('errText');
      if(!el || !pre) return;
      pre.textContent = String(msg || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
      el.style.display = 'block';
    }catch(_){}
  };
  window.addEventListener('error', (e)=> show(e.message + (e.filename? `\\nat ${e.filename}:${e.lineno}:${e.colno}`:'')));
  window.addEventListener('unhandledrejection', (e)=> show('Promise ì˜¤ë¥˜: ' + (e.reason && e.reason.message ? e.reason.message : String(e.reason))));
})();

/**************** íƒ€ë¡œ ë°ì´í„°(ë©”ì´ì € 22ì¥ Â· ë¦¬ë¼ì´íŠ¸ ë²„ì „) ****************/
const MAJOR = [
  { n:"0. ë°”ë³´ (The Fool) ğŸƒ",
    u:["ìƒˆì¶œë°œ","ì¦‰í¥","ììœ "], r:["ë¬´ëª¨","ë¶ˆì•ˆì •","ë°©í™©"],
    au:"ìƒˆë¡œìš´ ì‹œì‘ ì•ì— ì„œ ìˆìŠµë‹ˆë‹¤. ì‘ì€ ëª¨í—˜ì´ í° ê¸°íšŒë¥¼ ë¶ˆëŸ¬ì˜¬ ê±°ì˜ˆìš”.",
    ar:"ì¤€ë¹„ë˜ì§€ ì•Šì€ ì„ íƒì€ ë¶ˆì•ˆì •ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì ì‹œ ë©ˆì¶”ê³  ë°œíŒì„ ë‹¤ì ¸ë³´ì„¸ìš”." },
  { n:"I. ë§ˆë²•ì‚¬ (The Magician) âœ¨",
    u:["ì˜ì§€","ì°½ì¡°","ì»¤ë®¤ë‹ˆì¼€ì´ì…˜"], r:["ì†ì„ìˆ˜","ì‚°ë§Œ","ì§‘ì¤‘ë ¥ì €í•˜"],
    au:"ì§€ê¸ˆì€ ë§ê³¼ í–‰ë™ì´ ì˜ ë§ì•„ë–¨ì–´ì§‘ë‹ˆë‹¤. ìì‹ ê°ì„ ê°€ì§€ê³  ì›€ì§ì´ì„¸ìš”.",
    ar:"ìš•ì‹¬ì´ ë§ì•„ ì‚°ë§Œí•´ì§ˆ ìˆ˜ ìˆì–´ìš”. ì¤‘ìš”í•œ í•œ ê°€ì§€ì— ì§‘ì¤‘í•˜ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤." },
  { n:"II. ì—¬ì‚¬ì œ (The High Priestess) ğŸŒ™",
    u:["ì§ê´€","ë¹„ë°€","ë‚´ë©´"], r:["í˜¼ë€","ì–µì••ëœê°ì •","í”¼ìƒ"],
    au:"ì§ê´€ê³¼ ê°ê°ì´ ë¹›ë‚˜ëŠ” ë•Œì…ë‹ˆë‹¤. ë§ˆìŒì† ëª©ì†Œë¦¬ì— ê·€ ê¸°ìš¸ì—¬ ë³´ì„¸ìš”.",
    ar:"ê²‰ëª¨ìŠµì—ë§Œ ì§‘ì°©í•˜ì§€ ë§ê³  ê¹Šì´ ë“¤ì—¬ë‹¤ë³´ì„¸ìš”. ê°ì •ì´ ì–µëˆŒë ¤ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤." },
  { n:"III. ì—¬í™©ì œ (The Empress) ğŸŒ¿",
    u:["í’ìš”","ëŒë´„","ì°½ì˜"], r:["ê³¼ì‰","ì§€ë‚˜ì¹œì˜ì¡´","ì •ì²´"],
    au:"í’ìš”ì™€ ë”°ëœ»í•œ ëŒë´„ì´ ë‹¹ì‹ ì„ ê°ì‹¸ê³  ìˆìŠµë‹ˆë‹¤. ì°½ì˜ë ¥ë„ ë¹›ì„ ë°œí•  ê±°ì˜ˆìš”.",
    ar:"ê³¼í•œ ë°°ë ¤ëŠ” ì˜¤íˆë ¤ ì§€ì¹˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”. ìì‹ ì„ ìœ„í•œ ì„ ë„ í•„ìš”í•©ë‹ˆë‹¤." },
  { n:"IV. í™©ì œ (The Emperor) ğŸ›¡ï¸",
    u:["ì§ˆì„œ","í†µì œ","ê¶Œìœ„"], r:["ì™„ê³ ","ê²½ì§","ê¶Œìœ„ì¶©ëŒ"],
    au:"ì§ˆì„œì™€ ê·œìœ¨ì´ í˜ì´ ë©ë‹ˆë‹¤. ê³„íšê³¼ ì›ì¹™ì„ ì„¸ìš°ë©´ ì¼ì´ í’€ë¦´ ê±°ì˜ˆìš”.",
    ar:"ì™„ê³ í•¨ì€ ê°ˆë“±ì„ ë¶€ë¦…ë‹ˆë‹¤. ìœ ì—°í•˜ê²Œ íƒ€í˜‘í•˜ëŠ” íƒœë„ê°€ í•„ìš”í•©ë‹ˆë‹¤." },
  { n:"V. êµí™© (The Hierophant) ğŸ“–",
    u:["ì „í†µ","ë©˜í† ","í•™ìŠµ"], r:["í˜•ì‹ì£¼ì˜","ê³ ì§‘","íì‡„ì„±"],
    au:"ê²½í—˜ ë§ì€ ì‚¬ëŒì´ë‚˜ ì „í†µì ì¸ ë°©ë²•ì—ì„œ ë°°ì›€ì˜ ê¸°íšŒë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    ar:"ê´€ìŠµì´ í•­ìƒ ì •ë‹µì€ ì•„ë‹™ë‹ˆë‹¤. ë³¸ì§ˆì ì¸ ëª©ì ì„ ë¨¼ì € ì‚´í´ë³´ì„¸ìš”." },
  { n:"VI. ì—°ì¸ (The Lovers) â¤ï¸",
    u:["ì„ íƒ","ìœ ëŒ€","ì¡°í™”"], r:["ìš°ìœ ë¶€ë‹¨","ë¶ˆí˜‘","ìœ í˜¹"],
    au:"ê´€ê³„ ì†ì—ì„œ ì¡°í™”ì™€ ìœ ëŒ€ê°€ ê¹Šì–´ì§‘ë‹ˆë‹¤. ì§„ì‹¬ì´ ë‹´ê¸´ ì„ íƒì´ ì¢‹ì€ ê²°ê³¼ë¥¼ ë§Œë“­ë‹ˆë‹¤.",
    ar:"ê°ì •ê³¼ í˜„ì‹¤ì´ ì¶©ëŒí•  ìˆ˜ ìˆì–´ìš”. ê²½ê³„ì™€ ê¸°ì¤€ì„ ì„¸ìš°ëŠ” ê²Œ í•„ìš”í•©ë‹ˆë‹¤." },
  { n:"VII. ì „ì°¨ (The Chariot) ğŸ",
    u:["ëŒíŒŒ","ì†ë„","ìŠ¹ë¦¬"], r:["í­ì£¼","ì‚°ë§Œ","í†µì œë¶ˆëŠ¥"],
    au:"ì§‘ì¤‘ë ¥ê³¼ ì¶”ì§„ë ¥ì´ ê°•í•´ì§‘ë‹ˆë‹¤. ì†ë„ë¥¼ ìœ ì§€í•˜ë©° ì•ìœ¼ë¡œ ë‚˜ì•„ê°€ì„¸ìš”.",
    ar:"ë„ˆë¬´ ë¹ ë¥¸ ì§ˆì£¼ëŠ” ë°©í–¥ì„ ìƒì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì ì‹œ ì†ë„ë¥¼ ì¡°ì ˆí•´ ë³´ì„¸ìš”." },
  { n:"VIII. í˜ (Strength) ğŸ¦",
    u:["ìš©ê¸°","ì¸ë‚´","ìê¸°ì¡°ì ˆ"], r:["ë¶ˆì•ˆ","ê³¼ë¯¼","ì˜ìš•ì €í•˜"],
    au:"ë¶€ë“œëŸ½ì§€ë§Œ ë‹¨ë‹¨í•œ ì¸ë‚´ì‹¬ì´ í˜ì´ ë©ë‹ˆë‹¤. ìì‹ ì„ ë¯¿ìœ¼ì„¸ìš”.",
    ar:"ì–µì§€ë¡œ ë²„í‹°ê¸°ë³´ë‹¤ íšŒë³µì˜ ì‹œê°„ì„ ê°–ëŠ” ê²Œ ë” í° ìš©ê¸°ë¥¼ ì¤ë‹ˆë‹¤." },
  { n:"IX. ì€ë‘”ì (The Hermit) ğŸ•¯ï¸",
    u:["ì„±ì°°","ì—°êµ¬","ì§‘ì¤‘"], r:["ê³ ë¦½","ì§€ì—°","íì‡„"],
    au:"í˜¼ìë§Œì˜ ê¹Šì€ ì„±ì°°ì´ ë‹µì„ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³ ìš” ì†ì—ì„œ ê¸¸ì„ ì°¾ìœ¼ì„¸ìš”.",
    ar:"ê³ ë¦½ì€ ì˜¤íˆë ¤ ë°œëª©ì„ ì¡ìŠµë‹ˆë‹¤. ë„ì›€ì„ ì²­í•˜ëŠ” ê²ƒë„ ìš©ê¸°ì…ë‹ˆë‹¤." },
  { n:"X. ìš´ëª…ì˜ ìˆ˜ë ˆë°”í€´ (Wheel of Fortune) ğŸ¡",
    u:["ì „í™˜","í–‰ìš´","ìˆœí™˜"], r:["ë³€ë•","í†µì œë¶ˆê°€","íƒ€ì´ë°ì•…"],
    au:"ì˜ˆìƒì¹˜ ëª»í•œ ì „í™˜ì´ ì°¾ì•„ì˜µë‹ˆë‹¤. íë¦„ì„ íƒ€ëŠ” ê²ƒì´ ì§€í˜œì…ë‹ˆë‹¤.",
    ar:"ì§€ê¸ˆì€ í° ë„ë°•ë³´ë‹¤ ê´€ë§ì´ ìœ ë¦¬í•©ë‹ˆë‹¤. íƒ€ì´ë°ì„ ê¸°ë‹¤ë¦¬ì„¸ìš”." },
  { n:"XI. ì •ì˜ (Justice) âš–ï¸",
    u:["ê³µì •","ê³„ì•½","ê· í˜•"], r:["ë¶ˆê· í˜•","ë¶ˆì´ìµ","í¸í–¥"],
    au:"ê³µì •í•¨ì´ ì¤‘ì‹¬ì´ ë˜ëŠ” ìˆœê°„ì…ë‹ˆë‹¤. ì‚¬ì‹¤ê³¼ ê·œì¹™ì— ë”°ë¼ íŒë‹¨í•˜ì„¸ìš”.",
    ar:"í¸í–¥ëœ ì‹œê°ì€ ì†í•´ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìë£Œë¥¼ ê²€í† í•´ ë³´ì„¸ìš”." },
  { n:"XII. ë§¤ë‹¬ë¦° ì‚¬ëŒ (The Hanged Man) ğŸª¢",
    u:["ì‹œê°ì „í™˜","í¬ìƒ","ë©ˆì¶¤"], r:["ì§€ì²´","ê³ ì§‘","ë¹„íš¨ìœ¨"],
    au:"ì ì‹œ ë©ˆì¶”ëŠ” ì‹œê°„ì´ ì˜¤íˆë ¤ ë„ì•½ì˜ ë°œíŒì´ ë©ë‹ˆë‹¤. ì‹œê°ì„ ë°”ê¿”ë³´ì„¸ìš”.",
    ar:"ì–µì§€ë¡œ ë§¤ë‹¬ë¦¬ê¸°ë³´ë‹¤ ë‚´ë ¤ë†“ëŠ” ê²ƒì´ íš¨ìœ¨ì ì¼ ë•Œë„ ìˆìŠµë‹ˆë‹¤." },
  { n:"XIII. ì£½ìŒ (Death) ğŸ¦‹",
    u:["ì¢…ê²°","ì •ë¦¬","ì¬ìƒ"], r:["ì§‘ì°©","ë¯¸ë£¨ê¸°","ì •ì²´"],
    au:"ì˜¤ë˜ëœ ê²ƒì„ ì •ë¦¬í•  ë•Œ, ìƒˆë¡œìš´ ê¸¸ì´ ì—´ë¦½ë‹ˆë‹¤. ëë§ºìŒì´ ê³§ ì‹œì‘ì…ë‹ˆë‹¤.",
    ar:"ë¶™ì¡ê³  ìˆëŠ” ì§‘ì°©ì„ ë‚´ë ¤ë†“ì•„ì•¼ ë‹¤ì‹œ íë¦„ì´ ëŒì•„ì˜µë‹ˆë‹¤." },
  { n:"XIV. ì ˆì œ (Temperance) ğŸ’§",
    u:["ì¡°ìœ¨","ê· í˜•","ì¹˜ìœ "], r:["ê³¼ìœ ë¶ˆê¸‰","ê¸°ë³µ","ì‹¤ìˆ˜"],
    au:"ì¡°ìœ¨ê³¼ ê· í˜•ì´ ì„±ê³¼ë¥¼ ë§Œë“­ë‹ˆë‹¤. ë¬´ë¦¬í•˜ì§€ ë§ê³  ì¡°í™”ë¡­ê²Œ ë‚˜ì•„ê°€ì„¸ìš”.",
    ar:"ê³¼ìœ ë¶ˆê¸‰ì€ ì‹¤ìˆ˜ë¥¼ ë¶€ë¦…ë‹ˆë‹¤. ì†ë„ë¥¼ ì¤„ì´ê³  ë¯¸ì„¸í•˜ê²Œ ì¡°ì •í•´ ë³´ì„¸ìš”." },
  { n:"XV. ì•…ë§ˆ (The Devil) ğŸ”—",
    u:["ì§‘ì°©","ìœ í˜¹","ê³„ì•½"], r:["í•´ë°©","ìê°","ì ˆì œ"],
    au:"ë‹¬ì½¤í•œ ìœ í˜¹ì—” ëŒ€ê°€ê°€ ìˆìŠµë‹ˆë‹¤. ì¡°ê±´ì„ ê¼¼ê¼¼íˆ ì‚´í´ë³´ì„¸ìš”.",
    ar:"ì˜¬ê°€ë¯¸ë¥¼ ì•Œì•„ì°¨ë¦° ìˆœê°„ ì´ë¯¸ ë°˜ì¯¤ ë²—ì–´ë‚œ ê²ƒì…ë‹ˆë‹¤. í•´ë°©ì„ ì„ íƒí•˜ì„¸ìš”." },
  { n:"XVI. íƒ‘ (The Tower) âš¡",
    u:["ì¶©ê²©","ë¶•ê´´","ê°ì„±"], r:["í”¼í•´ê°ì†Œ","ê²½ê³ ","ë³µêµ¬"],
    au:"ì˜ˆìƒì¹˜ ëª»í•œ ë³€í™”ê°€ ì¼ì–´ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì§„ì§œ ë¬¸ì œë¥¼ ë“œëŸ¬ë‚´ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.",
    ar:"ì‘ì€ ê· ì—´ì¼ìˆ˜ë¡ íšŒë³µì´ ë¹ ë¦…ë‹ˆë‹¤. ê²½ê³ ë¥¼ ê¸°íšŒë¡œ ì‚¼ìœ¼ì„¸ìš”." },
  { n:"XVII. ë³„ (The Star) ğŸŒŸ",
    u:["í¬ë§","ì˜ê°","íšŒë³µ"], r:["ì˜ì‹¬","í˜„ì‹¤íšŒí”¼","ì§€ì—°"],
    au:"ì‘ì€ í¬ë§ì´ ê¸¸ì„ ë¹„ì¶¥ë‹ˆë‹¤. ë¯¿ìŒì„ í‚¤ìš°ë©´ ì˜ê°ì´ ì»¤ì§‘ë‹ˆë‹¤.",
    ar:"í¬ë§ë§Œìœ¼ë¡  ë¶€ì¡±í•©ë‹ˆë‹¤. ì§€ê¸ˆ í•„ìš”í•œ ê±´ ì‘ì€ ì‹¤í–‰ì…ë‹ˆë‹¤." },
  { n:"XVIII. ë‹¬ (The Moon) ğŸŒ˜",
    u:["ê°ì •","ì§ê°","ê¿ˆ"], r:["ì˜¤í•´","ë¶ˆì•ˆ","ë£¨ë¨¸"],
    au:"ê°ì •ê³¼ ì§ê´€ì´ ì˜ˆë¯¼í•´ì§‘ë‹ˆë‹¤. ë§ˆìŒì† ì´ì•¼ê¸°ë¥¼ ê¸°ë¡í•´ ë³´ì„¸ìš”.",
    ar:"í™•ì¸ë˜ì§€ ì•Šì€ ì†Œë¬¸ì´ë‚˜ ë¶ˆì•ˆì— í”ë“¤ë¦¬ì§€ ë§ˆì„¸ìš”. ì‚¬ì‹¤ì„ ë¨¼ì € ì ê²€í•˜ì„¸ìš”." },
  { n:"XIX. íƒœì–‘ (The Sun) â˜€ï¸",
    u:["ì„±ì·¨","ìì‹ ê°","ëª…ë£Œ"], r:["ì§€ì—°","ê³¼ì‹ ","ì†Œì§„"],
    au:"ì„±ì·¨ì™€ ìì‹ ê°ì´ ë¹›ë‚˜ëŠ” ìˆœê°„ì…ë‹ˆë‹¤. ì ê·¹ì ìœ¼ë¡œ ì¶”ì§„í•´ë„ ì¢‹ìŠµë‹ˆë‹¤.",
    ar:"ì§€ë‚˜ì¹œ ìì‹ ê°ì€ ì†Œì§„ì„ ë¶€ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì»¨ë””ì…˜ ê´€ë¦¬ì— ì§‘ì¤‘í•˜ì„¸ìš”." },
  { n:"XX. ì‹¬íŒ (Judgement) ğŸº",
    u:["ë¶€í™œ","í‰ê°€","ê²°ì •"], r:["í›„íšŒ","ë¯¸ì™„","ì—°ê¸°"],
    au:"ê³¼ê±°ì˜ ê²½í—˜ì´ ìƒˆë¡œìš´ ê²°ì •ì„ ë„ì™€ì¤ë‹ˆë‹¤. ë§ˆë¬´ë¦¬í•  ìš©ê¸°ë¥¼ ë‚´ì„¸ìš”.",
    ar:"ì•„ì§ íŒë‹¨í•˜ê¸° ì´ë¥¸ ë•Œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìë£Œì™€ ì‹œê°„ì„ ë” ëª¨ì•„ë³´ì„¸ìš”." },
  { n:"XXI. ì„¸ê³„ (The World) ğŸŒ",
    u:["ì™„ì„±","í†µí•©","ì—¬í–‰"], r:["ë¯¸ì™„ì„±","ë§ˆë¬´ë¦¬ì§€ì—°","í©ì–´ì§"],
    au:"ì™„ì„±ì˜ ê¸°ì¨ì´ ì°¾ì•„ì˜µë‹ˆë‹¤. ë§ˆë¬´ë¦¬ ë’¤ì—” ìƒˆë¡œìš´ ì—¬ì •ì´ ì—´ë¦´ ê±°ì˜ˆìš”.",
    ar:"ë§ˆë¬´ë¦¬ê°€ ë¯¸ë¤„ì§€ê³  ìˆìŠµë‹ˆë‹¤. ë¹ ì§„ ë¶€ë¶„ì´ ì—†ëŠ”ì§€ ì ê²€í•˜ì„¸ìš”." },
];

/**************** ìœ í‹¸ ****************/
const $ = sel => document.querySelector(sel);
const dateText = $("#dateText");
const isReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

/* ë‚ ì§œ í¬ë§· í´ë°± */
function fmtDateHuman(){
  try{
    if (Intl && Intl.DateTimeFormat) {
      const fmt = new Intl.DateTimeFormat("ko-KR",{dateStyle:"full"});
      return fmt.format(new Date()).replace(/\s*ì—­\s*$/,"");
    }
  }catch(_){}
  const d = new Date();
  return d.getFullYear()+"."+String(d.getMonth()+1).padStart(2,"0")+"."+String(d.getDate()).padStart(2,"0");
}
function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

// LCG ê¸°ë°˜ ì‹œë“œ ë‚œìˆ˜ (ë§í¬ ê³µìœ ìš© ì¬í˜„ ê°€ëŠ¥) â€” 2**32 ëŒ€ì‹  ì •ìˆ˜ ìƒìˆ˜ ì‚¬ìš©
function LCG(seed){
  let s = (seed>>>0);
  return function(){
    s = (s*1664525 + 1013904223)>>>0;
    return s / 4294967296; // 2**32
  };
}
function parseSeed(){
  try{
    const u = new URL(location.href);
    const s = u.searchParams.get('s');
    if (s===null) return null;
    const n = Number(s);
    return Number.isFinite(n) ? n : null;
  }catch(_){ return null; }
}
function makeSeedLink(res){
  const u=new URL(location.href);
  const seed = (res.seed||Date.now())>>>0;
  u.searchParams.set('s', String(seed));
  return u.toString();
}

/**************** ì—˜ë¦¬ë¨¼íŠ¸ ****************/
const cardEl   = $("#card");
const nameEl   = $("#cardName");
const dirEl    = $("#cardDir");
const kwEl     = $("#keywords");
const advEl    = $("#advice");
const drawBtn  = $("#drawBtn");
const flipBtn  = $("#flipBtn");
const shareBtn = $("#shareBtn");
const linkBtn  = $("#linkBtn");
const resetBtn = $("#resetBtn");

const tabGeneral = $("#tabGeneral");
const tabLove = $("#tabLove");
const tabWork = $("#tabWork");
const tabMoney = $("#tabMoney");
const panelTitle = $("#panelTitle");
const line1 = $("#line1");
const line2 = $("#line2");
const line3 = $("#line3");
const historyEl = $("#history");

/**************** ìƒíƒœ ****************/
let currentRes = null; // {idx, upright, ts, seed}
let currentTab = "general";
const HISTORY_KEY = 'tarotHistoryV2';

/**************** ë Œë”ë§ ****************/
function renderResult(res){
  if(!res){
    nameEl.textContent = "ì¹´ë“œë¥¼ ë½‘ì•„ë³´ì„¸ìš”";
    dirEl.textContent = "ì •/ì—­ë°©í–¥";
    kwEl.innerHTML = "";
    advEl.textContent = "ì—¬ê¸°ì— ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
    advEl.className = "advice";
    renderDomainPanel(null);
    return;
  }
  const card = MAJOR[res.idx];
  const isUpright = res.upright;
  nameEl.textContent = card.n;
  dirEl.textContent = isUpright ? "ì •ë°©í–¥" : "ì—­ë°©í–¥";
  kwEl.innerHTML = "";
  (isUpright?card.u:card.r).forEach(k=>{
    const span=document.createElement("span"); span.className="pill"; span.textContent=k; kwEl.appendChild(span);
  });
  advEl.textContent = isUpright ? card.au : card.ar;
  advEl.className = "advice " + (isUpright ? "good" : (res.idx===15||res.idx===16 ? "bad" : ""));
  renderDomainPanel(res);
}

/* ìì—°ìŠ¤ëŸ¬ìš´ í†¤ íŒ¨ë„ */
function renderDomainPanel(res){
  if(!res){
    panelTitle.textContent = "ì˜¤ëŠ˜ì˜ í•µì‹¬ ë©”ì‹œì§€";
    line1.textContent = "ì¹´ë“œë¥¼ ë½‘ìœ¼ë©´ ë¶„ì•¼ë³„ í•´ì„ì´ í‘œì‹œë©ë‹ˆë‹¤.";
    line2.textContent = "";
    line3.textContent = "";
    return;
  }

  const card = MAJOR[res.idx];
  const isUpright = res.upright;
  const kws = (isUpright ? card.u : card.r);

  if(currentTab === "general"){
    panelTitle.textContent = "ì˜¤ëŠ˜ì˜ í•µì‹¬ ë©”ì‹œì§€";
    line1.textContent = `â€œ${isUpright ? card.au : card.ar}â€`;
    line2.textContent = `ì—°ê´€ëœ í‚¤ì›Œë“œ: ${kws.join(", ")}`;
    line3.textContent = `ë‹¹ì‹ ì´ ë½‘ì€ ì¹´ë“œëŠ” ${card.n}ì´ë©°, ì´ë²ˆì—ëŠ” ${isUpright ? "ì •ë°©í–¥" : "ì—­ë°©í–¥"}ìœ¼ë¡œ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤.`;
  } else if(currentTab === "love"){
    panelTitle.textContent = "ì‚¬ë‘ ìš´ì„¸";
    line1.textContent = domainAdvice(card, isUpright, "love");
    line2.textContent = "ì˜¤ëŠ˜ì˜ í¬ì¸íŠ¸: ëŒ€í™”ì˜ â€˜ì§ˆâ€™ì— ì§‘ì¤‘í•˜ê³ , ê²½ê³„ì™€ ê¸°ëŒ€ì¹˜ë¥¼ í•¨ê»˜ ë§ì¶°ë³´ì„¸ìš”.";
    line3.textContent = "íŒ: ì‘ì€ ì¹œì ˆì´ë‚˜ ì§§ì€ ë©”ì‹œì§€ë¡œ ë¶„ìœ„ê¸°ë¥¼ ë¶€ë“œëŸ½ê²Œ ì—¬ì„¸ìš”.";
  } else if(currentTab === "work"){
    panelTitle.textContent = "ì¼(ì»¤ë¦¬ì–´) ìš´ì„¸";
    line1.textContent = domainAdvice(card, isUpright, "work");
    line2.textContent = "ì˜¤ëŠ˜ì˜ í¬ì¸íŠ¸: í•œ ê°€ì§€ë¥¼ ëê¹Œì§€â€”ê·¸ë¦¬ê³  ë°ì´í„°ë¡œ ì„¤ë“í•˜ì„¸ìš”.";
    line3.textContent = "íŒ: ë§ˆê°ê³¼ ì˜ì‚¬ê²°ì • ì‹œì ì„ ë¨¼ì € ì ì–´ ë‘ë©´ íë¦„ì´ ì¡í™ë‹ˆë‹¤.";
  } else {
    panelTitle.textContent = "ê¸ˆì „ ìš´ì„¸";
    line1.textContent = domainAdvice(card, isUpright, "money");
    line2.textContent = "ì˜¤ëŠ˜ì˜ í¬ì¸íŠ¸: ì¶©ë™êµ¬ë§¤ë¥¼ í”¼í•˜ê³ , êµ¬ë…Â·ê³ ì •ë¹„ë¶€í„° ì ê²€í•˜ì„¸ìš”.";
    line3.textContent = "íŒ: ì˜¤ëŠ˜ì€ ë¹„êµÂ·ë³´ë¥˜Â·ì˜ˆë¹„ë¹„ ê°•í™” ì „ëµì´ ìœ ë¦¬í•©ë‹ˆë‹¤.";
  }
}

/**************** ë¶„ì•¼ë³„ í•´ì„ ****************/
const pick = (arr)=> arr[Math.floor(Math.random()*arr.length)];
function domainAdvice(card, upright, domain){
  const T = {
    love:{
      u:[
        "ê°ì •ì˜ {tone} íë¦„. ì†”ì§í•œ ëŒ€í™”ê°€ ë§¤ë ¥ì„ ë†’ì…ë‹ˆë‹¤.",
        "ìƒˆ ì¸ì—° ë˜ëŠ” ê´€ê³„ íšŒë³µì˜ íë¦„ì´ ë³´ì…ë‹ˆë‹¤. {tip}",
        "ì†ë„ë¥¼ ë§ì¶”ë©´ ê±°ë¦¬ê°ì´ ìì—°ìŠ¤ëŸ½ê²Œ ì¤„ì–´ë“­ë‹ˆë‹¤."
      ],
      r:[
        "ê°ì • ê¸°ë³µ ì£¼ì˜. {trap}ì— íœ˜ë‘˜ë¦¬ì§€ ì•Šë„ë¡ ê²½ê³„í•˜ì„¸ìš”.",
        "ì„œë‘ë¥´ë©´ ì˜¤í•´ê°€ ì»¤ì§‘ë‹ˆë‹¤. {tip}",
        "ê´€ê³„ì˜ ê²½ê³„ì™€ ì—­í• ì„ ë‹¤ì‹œ ì •í•  ì‹œê°„ì´ í•„ìš”í•©ë‹ˆë‹¤."
      ],
      tips:["ì‘ì€ ì—°ë½ ë¨¼ì €","ëŒ€í™”ì˜ ì§ˆì— ì§‘ì¤‘","ê°ì • ê¸°ë¡í•˜ê¸°","ê¸°ëŒ€ì¹˜ ì¡°ìœ¨í•˜ê¸°"],
      traps:["ê³¼ë„í•œ ê¸°ëŒ€","í™•ì‹  ì—†ëŠ” ë°€ë‹¹","ë¹„êµ ìŠµê´€","ë‹µì •ë„ˆ ëŒ€í™”"]
    },
    work:{
      u:[
        "ì—…ë¬´ì˜ {tone} íë¦„. í•µì‹¬ í•œ ê°€ì§€ë¥¼ ì™„ì£¼í•˜ë©´ ì„±ê³¼ê°€ ë‚©ë‹ˆë‹¤.",
        "ë„ì›€ê³¼ ë©˜í†  ìš´ì´ ìˆìŠµë‹ˆë‹¤. {tip}",
        "íƒ€ì´ë°ì´ ì¢‹ìŠµë‹ˆë‹¤. ê³„íšì„ ì‹¤í–‰í•´ ë³´ì„¸ìš”."
      ],
      r:[
        "ìš°ì„ ìˆœìœ„ í˜¼ì„  ì£¼ì˜. {trap}ë¥¼ ì¤„ì´ì„¸ìš”.",
        "ì†ë„ë¥¼ ë‚®ì¶”ê³  ì •í•©ì„±ì„ ì ê²€í•  ë•Œì…ë‹ˆë‹¤.",
        "ê´€ì„±ëŒ€ë¡œ ê°€ì§€ ë§ê³  í”„ë¡œì„¸ìŠ¤ë¥¼ ì¬ì •ë¹„í•˜ì„¸ìš”."
      ],
      tips:["ë ˆí¼ëŸ°ìŠ¤ í™•ë³´","ë©”ëª¨ë¡œ íë¦„ ì¡ê¸°","ì˜¤ëŠ˜ 1íƒœìŠ¤í¬ ì™„ì£¼","ë°ë“œë¼ì¸ ì¬í™•ì¸"],
      traps:["íšŒì˜ ê³¼ë‹¤","ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­","ë¯¸ë£¨ê¸°","ì™„ë²½ì£¼ì˜ ë£¨í”„"]
    },
    money:{
      u:[
        "í˜„ê¸ˆíë¦„ì´ {tone}. {tip}ì— ì´ˆì ì„ ë§ì¶”ë©´ ì•ˆì •ì ì…ë‹ˆë‹¤.",
        "ì‘ì€ ì ˆì•½ê³¼ ìˆ˜ìµí™” ì•„ì´ë””ì–´ê°€ íš¨ìœ¨ì„ ë§Œë“­ë‹ˆë‹¤.",
        "ê³„íšì  ì§€ì¶œì´ ìˆ˜ìµë¥ ì„ ì§€ì¼œì¤ë‹ˆë‹¤."
      ],
      r:[
        "ì¶©ë™ì†Œë¹„Â·ê³¼ì‹  ì£¼ì˜. {trap}ì„ í”¼í•˜ì„¸ìš”.",
        "í° ë² íŒ…ì€ ë³´ë¥˜í•˜ê³ , í˜„ê¸ˆ ì¿ ì…˜ì„ ë¨¼ì € í™•ë³´í•˜ì„¸ìš”.",
        "ì¡°ê±´ í™•ì¸ ì—†ëŠ” ì„œëª… ê¸ˆì§€â€”ì¡°í•­ì„ ì¬ê²€í† í•˜ì„¸ìš”!"
      ],
      tips:["ì§€ì¶œ ì¹´í…Œê³ ë¦¬ ì œí•œ","êµ¬ë… ì ê²€","ê°€ê²© ë¹„êµ","ì˜ˆë¹„ë¹„ ìš°ì„ "],
      traps:["ë¬´ì´ìì— ë°©ì‹¬","í• ì¸ ìœ í˜¹","ì •ë³´ ë¹„ëŒ€ì¹­","ìˆ˜ìµë¥  ê³¼ëŒ€í‰ê°€"]
    }
  };
  const tone = upright ? pick(["ë§‘ê³  ê²½ì¾Œí•œ","ì•ˆì •ì ì¸","í™•ì¥ì ì¸"]) : pick(["ìš¸í‰ë¶ˆí‰í•œ","íë¦¿í•œ","ë³€ë•ìŠ¤ëŸ¬ìš´"]);
  const kws = upright ? card.u : card.r;
  const tpl = upright ? pick(T[domain].u) : pick(T[domain].r);
  const tip = pick(T[domain].tips);
  const trap = pick(T[domain].traps);
  return tpl.replace("{tone}", kws[0]||"íë¦„").replace("{tip}", tip).replace("{trap}", trap);
}

/**************** íˆìŠ¤í† ë¦¬ ****************/
function loadHistory(){
  try{ return JSON.parse(localStorage.getItem(HISTORY_KEY)||'[]'); }catch{ return [] }
}
function saveHistory(list){
  try{ localStorage.setItem(HISTORY_KEY, JSON.stringify(list.slice(0,10))); }catch{}
}
function pushHistory(res){
  const card = MAJOR[res.idx];
  const entry = { t: res.ts, n: card.n, u: res.upright, s: res.seed||null };
  const list = [entry, ...loadHistory()].slice(0,10);
  saveHistory(list); renderHistory(list);
}
function renderHistory(list=loadHistory()){
  historyEl.innerHTML = '';
  if(!list.length){ historyEl.innerHTML = '<div class="date">ê¸°ë¡ ì—†ìŒ</div>'; return; }
  list.forEach(e=>{
    const div = document.createElement('div'); div.className='hist-item';
    const dot = document.createElement('div'); dot.className = 'dot '+(e.u?'u':'r'); div.appendChild(dot);
    const txt = document.createElement('div');
    const d = new Date(e.t);
    try{
      const fmtTxt = new Intl.DateTimeFormat('ko-KR',{month:'numeric',day:'numeric',hour:'2-digit',minute:'2-digit'}).format(d);
      txt.textContent = `${fmtTxt} Â· ${e.n} Â· ${e.u?'ì •':'ì—­'}`;
    }catch(_){
      txt.textContent = `${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')} Â· ${e.n} Â· ${e.u?'ì •':'ì—­'}`;
    }
    div.appendChild(txt);
    div.addEventListener('click',()=>{
      if(e.s!=null){ location.href = setSeedInUrl(e.s); }
      else { currentRes = { idx: nameToIndex(e.n), upright:e.u, ts: Date.now() }; renderResult(currentRes); flipCard(true); }
    });
    historyEl.appendChild(div);
  });
}
function nameToIndex(name){ return clamp(MAJOR.findIndex(c=>c.n===name),0,MAJOR.length-1) }
function setSeedInUrl(seed){ const u=new URL(location.href); u.searchParams.set('s', String(seed>>>0)); return u.toString(); }

/**************** ë™ì‘ ****************/
function flipCard(toBack=true){
  const flipped = cardEl.classList.contains("flipped");
  if(toBack && !flipped) cardEl.classList.add("flipped");
  if(!toBack && flipped) cardEl.classList.remove("flipped");
}
function drawRandom(){
  const seedParam = parseSeed();
  if(seedParam!=null){
    const rnd = LCG(seedParam);
    const idx = Math.floor(rnd()*MAJOR.length);
    const upright = rnd() < 0.5;
    return { idx, upright, ts: Date.now(), seed: seedParam };
  }
  const idx = Math.floor(Math.random()*MAJOR.length);
  const upright = Math.random() < 0.5;
  return { idx, upright, ts: Date.now(), seed: Date.now() };
}
function applyDraw({autoFlipDelay=250}={}){
  const res = drawRandom();
  currentRes = res;
  renderResult(res);
  if(navigator.vibrate) try{ navigator.vibrate(8); }catch(_){}
  if(!isReduced) setTimeout(()=>flipCard(true), autoFlipDelay);
  pushHistory(res);
}
function setTab(tab){
  currentTab = tab;
  [tabGeneral,tabLove,tabWork,tabMoney].forEach(b=>b.setAttribute("aria-selected","false"));
  ({"general":tabGeneral,"love":tabLove,"work":tabWork,"money":tabMoney}[tab]).setAttribute("aria-selected","true");
  renderDomainPanel(currentRes);
}

/**************** ì´ë²¤íŠ¸ ****************/
drawBtn.addEventListener("click", ()=>applyDraw({autoFlipDelay:250}));
flipBtn.addEventListener("click", ()=> cardEl.classList.toggle("flipped"));
cardEl.addEventListener("click", ()=> cardEl.classList.toggle("flipped"));
cardEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); cardEl.classList.toggle('flipped'); }});
resetBtn.addEventListener("click", ()=>{
  currentRes = null; renderResult(null); flipCard(false);
});
shareBtn.addEventListener("click", async ()=>{
  if(!currentRes){ alert("ë¨¼ì € ì¹´ë“œë¥¼ ë½‘ì•„ì£¼ì„¸ìš”!"); return; }
  const c = MAJOR[currentRes.idx];
  const dir = currentRes.upright ? "ì •ë°©í–¥" : "ì—­ë°©í–¥";
  const kws = (currentRes.upright ? c.u : c.r).join(", ");
  const msg = `ğŸ”® ì˜¤ëŠ˜ì˜ íƒ€ë¡œ (${fmtDateHuman()})\nì¹´ë“œ: ${c.n} Â· ${dir}\ní‚¤ì›Œë“œ: ${kws}\ní•µì‹¬: ${currentRes.upright ? c.au : c.ar}`;
  try{
    if (navigator.share) await navigator.share({ title:"ì˜¤ëŠ˜ì˜ íƒ€ë¡œ", text:msg });
    else { await navigator.clipboard.writeText(msg); alert("ë³µì‚¬ ì™„ë£Œ! ì›í•˜ëŠ” ê³³ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”."); }
  }catch(_){}
});
linkBtn.addEventListener('click', async ()=>{
  if(!currentRes){ alert('ë¨¼ì € ì¹´ë“œë¥¼ ë½‘ì•„ì£¼ì„¸ìš”!'); return; }
  const url = makeSeedLink(currentRes);
  try{ await navigator.clipboard.writeText(url); alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'); }
  catch{ prompt('ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”', url); }
});

// íƒ­
[ [tabGeneral,'general'],[tabLove,'love'],[tabWork,'work'],[tabMoney,'money'] ].forEach(([btn,tab])=> btn.addEventListener('click',()=>setTab(tab)) );

// ë‹¨ì¶•í‚¤
window.addEventListener('keydown',(e)=>{
  if(e.target && ['INPUT','TEXTAREA'].includes(e.target.tagName)) return;
  if(e.key==='d' || e.key==='D') applyDraw({autoFlipDelay:200});
  if(e.key==='f' || e.key==='F') cardEl.classList.toggle('flipped');
  if(e.key==='l' || e.key==='L') linkBtn.click();
});

// ì´ˆê¸°
function init(){
  try{
    dateText.textContent = fmtDateHuman();
    renderHistory();
    // ì‹œë“œê°€ ìˆëŠ” ê²½ìš° ìë™ ë½‘ê¸° + ë°”ë¡œ ë’¤ì§‘ê¸°
    if(parseSeed()!=null){ applyDraw({autoFlipDelay: isReduced?0:120}); }
  }catch(err){
    const pre = document.getElementById('errText');
    const ov = document.getElementById('errOverlay');
    if(pre && ov){ pre.textContent = String(err && err.message ? err.message : err); ov.style.display='block'; }
  }
}
init();
</script>
</body>
</html>