<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>오늘의 선물 운세</title>
<meta name="theme-color" content="#FFE18A"/>
<meta name="description" content="선물상자를 열면 오늘의 운세가 펼쳐집니다. 금전·직장·애정·학업·건강 점수와 행운 키워드 제공."/>
<style>
  :root{
    --grid:#f8d875; --bg:#ffe18a; --ink:#5a3b1a; --accent:#ff8a42; --accent-deep:#ea6a1b;
    --card:#fffaf0; --muted:#8b6d4e;
  }
  *{box-sizing:border-box}
  html:focus-within{scroll-behavior:smooth}
  body{
    margin:0; font-family:ui-sans-serif,system-ui,-apple-system,"Pretendard","Segoe UI",sans-serif;
    color:var(--ink); background:
      repeating-linear-gradient(0deg, var(--bg), var(--bg) 48px, var(--grid) 48px, var(--grid) 50px), var(--bg);
    min-height:100dvh;
  }
  /* 헤더/푸터 */
  .site-header{position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:12px;justify-content:space-between;background:#fff;padding:10px 14px;border-bottom:1px solid #e5e7eb}
  .site-header .logo img{height:28px;max-width:140px;object-fit:contain}
  .site-header h1{margin:0;flex:1;text-align:center;font-size:1.05rem;color:#111}
  .site-header .today{font-size:.9rem;color:#444}
  footer{position:fixed;left:0;right:0;bottom:0;text-align:center;padding:10px 0;font-size:.85rem;color:#6b7280;background:rgba(255,255,255,.6);backdrop-filter:blur(6px);border-top:1px solid #e5e7eb}
  /* 레이아웃/전환 */
  .container{max-width:860px;margin:0 auto;padding:16px 16px 80px}
  .view{display:none;animation:.35s ease both fadeInUp}
  .view.active{display:block}
  @keyframes fadeInUp{from{opacity:0;transform:translate3d(0,10px,0)}to{opacity:1;transform:none}}
  /* 인트로 */
  .intro{display:grid;place-items:center;min-height:calc(100svh - 120px);text-align:center;gap:14px}
  .intro h2{margin:0;font-size:1.8rem;line-height:1.25;color:#7b4b22;text-shadow:0 2px 0 rgba(255,255,255,.35)}
  .intro p{margin:0;color:var(--muted)}
  .plate{margin-top:8px;width:min(78vw,360px);aspect-ratio:1/1;border-radius:24px;background:#fff;box-shadow:0 20px 40px rgba(0,0,0,.18) inset,0 24px 40px rgba(0,0,0,.18);display:grid;place-items:center}
  .touch-tip{margin-bottom:6px;font-size:1rem;color:#ad794e;opacity:.9}
  .gift{font-size:5rem;filter:drop-shadow(0 14px 22px rgba(0,0,0,.25));cursor:pointer}
  .gift:active{transform:scale(.98)}
  .cta{display:inline-block;margin-top:12px;padding:10px 16px;border-radius:999px;background:linear-gradient(180deg,var(--accent),var(--accent-deep));color:#fff;font-weight:700;box-shadow:0 6px 0 #ce5c14;user-select:none;cursor:pointer}
  .cta:active{transform:translateY(2px);box-shadow:0 4px 0 #ce5c14}
  /* 결과 카드 */
  .card{background:var(--card);border:1px solid #f2e5cf;border-radius:16px;padding:16px;box-shadow:0 10px 32px rgba(0,0,0,.12)}
  .result-msg{font-size:1.05rem;line-height:1.6;margin:0}
  .scores{margin-top:14px;display:grid;gap:10px}
  .row{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:10px}
  .label{font-weight:700}
  .bar{height:12px;border-radius:999px;background:#fde7d5;position:relative;overflow:hidden}
  .bar>i{position:absolute;inset:0;width:var(--w,0%);background:linear-gradient(90deg,#ff9f5c,#ff7a2a);border-radius:999px;transition:width .8s cubic-bezier(.2,.8,.2,1)}
  .val{font-weight:800;color:#d8611c}
  .kw{margin-top:14px}
  .kw h3{margin:0 0 8px;font-size:1rem}
  .kwgrid{display:grid;gap:10px}
  .krow{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:10px;padding:10px;border-radius:12px;background:#fff}
  .kico{font-size:1.15rem}
  .klabel{color:#7a5935}
  .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
  button{all:unset;cursor:pointer;padding:10px 14px;background:#fff;border:1px solid #e5e7eb;border-radius:10px;font-weight:700}
  button.primary{background:linear-gradient(180deg,#ff9f5c,#ff7a2a);color:#fff;border-color:#ff8a42}
  /* 오류 오버레이 */
  #errOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);color:#fff;z-index:9999;padding:16px;overflow:auto}
  #errOverlay pre{white-space:pre-wrap;word-break:break-word;background:rgba(255,255,255,.08);padding:12px;border-radius:8px}
</style>
</head>
<body>
  <!-- 헤더 -->
  <header class="site-header">
    <div class="logo">
      <img src="https://api.multicampus.com/ssf/v1/resource/public/images/FILBS202506207041267" alt="multicampus logo">
    </div>
    <h1>오늘의 선물</h1>
    <div class="today" id="today"></div>
  </header>

  <div class="container">
    <!-- 인트로 -->
    <section id="viewIntro" class="view intro active" aria-label="인트로">
      <div>
        <h2 id="introTitle">학습자님, 선물상자를 열면</h2>
        <p>자세한 오늘의 운세를 볼 수 있어요.</p>
      </div>
      <div class="plate" aria-hidden="true">
        <div class="touch-tip">Touch!</div>
        <div id="giftBtn" class="gift" role="button" tabindex="0" aria-label="선물상자 열기">🎁</div>
      </div>
      <div class="cta" id="cookieCta">열어주세요!</div>
    </section>

    <!-- 결과 -->
    <section id="viewResult" class="view" aria-label="운세 결과">
      <div class="card">
        <p class="result-msg" id="fortuneText">결과를 불러오는 중…</p>
        <div class="scores" id="scores"></div>
        <div class="kw">
          <h3>행운 키워드</h3>
          <div class="kwgrid" id="kwGrid"></div>
        </div>
        <div class="btns">
          <button id="againBtn" class="primary">다시 열기</button>
          <button id="shareBtn">공유/복사</button>
          <button id="linkBtn">링크</button>
        </div>
      </div>
    </section>
  </div>

  <footer>© multicampus arcade</footer>

  <!-- 오류 오버레이 -->
  <div id="errOverlay" role="alert" aria-live="assertive">
    <h3>스크립트 오류가 발생했습니다</h3>
    <p>복사/붙여넣기 과정에서 빠진 부분이 없는지 확인해 주세요.</p>
    <pre id="errText"></pre>
  </div>

<script>
"use strict";
/* 오류표시 */
(function(){const show=(m)=>{try{const el=document.getElementById('errOverlay');const pre=document.getElementById('errText');if(!el||!pre)return;pre.textContent=String(m||'알 수 없는 오류');el.style.display='block';}catch{}};window.addEventListener('error',(e)=>show(e.message+(e.filename?`\\nat ${e.filename}:${e.lineno}:${e.colno}`:'')));window.addEventListener('unhandledrejection',(e)=>show('Promise 오류: '+(e.reason&&e.reason.message?e.reason.message:String(e.reason))));})();
const $=s=>document.querySelector(s);
/* 날짜 */
function fmtDate(){try{return new Intl.DateTimeFormat('ko-KR',{dateStyle:'medium'}).format(new Date());}catch(_){const d=new Date();return `${d.getFullYear()}.${d.getMonth()+1}.${d.getDate()}`;}}
$('#today').textContent=fmtDate();
/* 난수/시드 */
function LCG(seed){let s=(seed>>>0);return()=>((s=(s*1664525+1013904223)>>>0)/4294967296);}
function parseSeed(){try{const u=new URL(location.href);const s=u.searchParams.get('s');if(s===null)return null;const n=Number(s);return Number.isFinite(n)?n:null;}catch(_){return null}}
function setSeedInUrl(seed){const u=new URL(location.href);u.searchParams.set('s',String(seed>>>0));history.replaceState(null,'',u);return u.toString();}
/* 데이터 */
const BANK={
  love:[
    "마음의 온도가 올라갑니다. 솔직한 한마디가 분위기를 바꿔요.",
    "속도를 맞추면 거리감이 자연스레 줄어듭니다.",
    "작은 배려가 큰 설렘으로 돌아옵니다.",
    "과거의 오해가 풀리며 관계가 맑아집니다.",
    "새 인연의 신호가 보입니다. 열린 태도가 행운."
  ],
  work:[
    "핵심 한 가지를 끝내면 성과가 큽니다.",
    "협업의 운이 들어와요. 도움을 주고받아 보세요.",
    "데이터와 근거가 당신의 편입니다.",
    "우선순위를 정리하면 속도가 납니다.",
    "짧은 집중이 큰 진전을 만듭니다."
  ],
  money:[
    "지출 계획이 수익을 지켜줍니다.",
    "충동구매를 피하면 만족도가 높습니다.",
    "작은 절약이 큰 여유로 이어집니다.",
    "가격 비교가 오늘의 필승 전략.",
    "예비비를 챙기면 마음이 편해집니다."
  ],
  study:[
    "분산 학습이 효율을 만듭니다—짧고 자주!",
    "개념 요약이 이해를 깊게 합니다.",
    "배운 것을 바로 적용해 보세요.",
    "루틴을 지키면 속도가 붙습니다.",
    "멘토의 한마디가 방향을 잡아줍니다."
  ],
  health:[
    "수면과 수분 보충이 컨디션을 살립니다.",
    "가벼운 운동이 활력을 채워줍니다.",
    "스트레칭으로 몸과 마음을 풀어주세요.",
    "무리는 금물, 회복이 곧 힘입니다.",
    "소식과 규칙이 오늘의 키."
  ],
  general:[
    "작은 시작이 큰 변화를 부릅니다.",
    "타이밍이 좋습니다. 가볍게 시도해 보세요.",
    "준비된 곳에 행운이 머뭅니다.",
    "첫 걸음이 방향을 만듭니다.",
    "꾸준함이 오늘의 치트키."
  ]
};
const DIRECTIONS=["동쪽","서쪽","남쪽","북쪽","동남","서남","동북","서북"];
const COLORS=["피어나는 핑크","호박 오렌지","순한 베이지","바나나 옐로","숲 그린","하늘 블루","보라 바이올렛","차분한 네이비"];
const FOODS=["순두부찌개","김치볶음밥","파스타","비빔국수","불고기","연어초밥","우동","치킨","팥빙수","라떼"];
const ICON={num:"📙",dir:"🧭",col:"🎨",food:"🍲"};
/* 요소 */
const viewIntro=$("#viewIntro"), viewResult=$("#viewResult"), giftBtn=$("#giftBtn"), cookieCta=$("#cookieCta");
const againBtn=$("#againBtn"), fortuneText=$("#fortuneText"), scoresEl=$("#scores"), kwGrid=$("#kwGrid"), shareBtn=$("#shareBtn"), linkBtn=$("#linkBtn");
/* 생성기 */
function gen(seed){
  const r = seed!=null ? LCG(seed) : Math.random;
  const pick = (arr)=> arr[Math.floor(r()*arr.length)];
  const n100 = ()=> Math.floor(60 + r()*40); // 60~100
  const scores={ 금전:n100(), 직장:n100(), 애정:n100(), 학업:n100(), 건강:n100() };
  const top = Object.entries(scores).sort((a,b)=>b[1]-a[1])[0][0];
  let domain='general';
  if(top==='애정')domain='love'; else if(top==='직장')domain='work'; else if(top==='금전')domain='money';
  else if(top==='학업')domain='study'; else if(top==='건강')domain='health';
  const message=pick(BANK[domain]);
  const lucky={ num:Math.floor(1+r()*99), dir:pick(DIRECTIONS), col:pick(COLORS), food:pick(FOODS) };
  return {scores,message,lucky};
}
/* 렌더 */
function renderScores(scores){
  scoresEl.innerHTML='';
  for(const [label,val] of Object.entries(scores)){
    const row=document.createElement('div'); row.className='row';
    const l=document.createElement('div'); l.className='label'; l.textContent=label;
    const bar=document.createElement('div'); bar.className='bar';
    const fill=document.createElement('i'); fill.style.setProperty('--w',val+'%'); bar.appendChild(fill);
    const v=document.createElement('div'); v.className='val'; v.textContent=`${val}점`;
    row.append(l,bar,v); scoresEl.appendChild(row);
    setTimeout(()=>{ fill.style.width=val+'%'; },30);
  }
}
function renderKeywords(kw){
  kwGrid.innerHTML='';
  [{ico:ICON.num,label:'숫자',value:String(kw.num)},
   {ico:ICON.dir,label:'방향',value:kw.dir},
   {ico:ICON.col,label:'컬러',value:kw.col},
   {ico:ICON.food,label:'음식',value:kw.food}]
  .forEach(r=>{
    const div=document.createElement('div'); div.className='krow';
    const i=document.createElement('div'); i.className='kico'; i.textContent=r.ico;
    const l=document.createElement('div'); l.className='klabel'; l.textContent=r.label;
    const v=document.createElement('div'); v.style.fontWeight='800'; v.textContent=r.value;
    div.append(i,l,v); kwGrid.appendChild(div);
  });
}
/* 화면 전환 */
function showResult(seed){
  const {scores,message,lucky}=gen(seed);
  fortuneText.textContent=message;
  renderScores(scores);
  renderKeywords(lucky);
  viewIntro.classList.remove('active'); viewResult.classList.add('active');
  if(navigator.vibrate) try{ navigator.vibrate(8);}catch(_){}
}
/* 이벤트 */
function openGift(){ const seed=parseSeed() ?? (Date.now()>>>0); setSeedInUrl(seed); showResult(seed); }
giftBtn.addEventListener('click',openGift);
giftBtn.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); openGift(); }});
cookieCta.addEventListener('click',openGift);
againBtn.addEventListener('click',()=>{ const seed=(Date.now()>>>0); setSeedInUrl(seed); showResult(seed); });
shareBtn.addEventListener('click',async ()=>{
  const text=`🎁 오늘의 선물 운세 (${fmtDate()})\n- ${fortuneText.textContent}\n- 링크: ${location.href}`;
  try{ if(navigator.share){ await navigator.share({title:"오늘의 선물 운세",text}); } else { await navigator.clipboard.writeText(text); alert('복사 완료! 원하는 곳에 붙여넣기 하세요.'); } }catch(_){}
});
linkBtn.addEventListener('click',async ()=>{ const url=location.href; try{ await navigator.clipboard.writeText(url); alert('링크가 복사되었습니다!'); } catch{ prompt('아래 링크를 복사하세요', url); }});
/* 인트로 이름/ID (?n=우성 / ?id=1729) */
(function(){ const u=new URL(location.href); const name=u.searchParams.get('n'); const id=u.searchParams.get('id'); const t=document.getElementById('introTitle');
  if(name){ t.textContent=`${name}님, 선물상자를 열면`; } else if(id){ t.textContent=`${id}님, 선물상자를 열면`; }
})();
</script>
</body>
</html>